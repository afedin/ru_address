# PostgreSQL импорт данных ГАР

Пакет `ru_address` включает команду `pipeline`, которая автоматизирует полный цикл:

1. загрузка ZIP архива с данными (HTTP/HTTPS/FTP или локальный путь);
2. скачивание XSD схемы (по умолчанию с https://fias.nalog.ru/docs/gar_schemas.zip, либо из источника, указанного флагом `--schema`);
3. генерация дампов таблиц напрямую из архивов без распаковки;
4. параллельный импорт данных в PostgreSQL через `psql`.

## Требования

- установленный `psql` (PostgreSQL 12+);
- права на создание/изменение таблиц в целевой базе;
- достаточно свободного места для временных файлов (создаются в системной `TemporaryDirectory`).

## Быстрый старт

```shell
$ ru_address pipeline \
    --dsn postgresql://user:password@localhost/gar \
    --jobs 4 \
    https://example.org/gar.zip
```

Если предпочтительнее передавать параметры подключения отдельно:

```shell
$ ru_address pipeline \
    --host localhost \
    --port 5432 \
    --user gar_user \
    --password example \
    --database gar \
    /path/to/gar.zip
```

* `--table` позволяет ограничить список таблиц (по умолчанию загружаются все известные);
* `--region` фильтрует регионы (по умолчанию забираются все каталоги из архива);
* `--jobs` задаёт количество воркеров `ProcessPoolExecutor`;
* `--keep-zip` оставляет скачанный архив данных в рабочей директории;
* `--schema` позволяет указать локальный путь или URL для XSD вместо дефолтной ссылки.

В случае ошибки импорта соответствующий SQL-файл сохраняется рядом с текущим каталогом под именем `<REGION>_failed.sql` для диагностики.
